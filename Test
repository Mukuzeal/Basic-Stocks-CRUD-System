from kivy.app import App
from kivy.uix.widget import Widget
from kivy.uix.label import Label
from kivy.graphics import Color, Ellipse
from kivy.clock import Clock
from kivy.core.window import Window
import random

Window.size = (800, 600)


class Target(Widget):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.size = (50, 50)
        self.center = (
            random.randint(100, Window.width - 100),
            random.randint(100, Window.height - 100),
        )
        self.radius = 25
        self.growing = True

        with self.canvas:
            self.color = Color(1, 0, 0)
            self.circle = Ellipse(pos=self.pos, size=self.size)

        Clock.schedule_interval(self.update, 1 / 60)

    def update(self, dt):
        # Animate: grow then shrink
        if self.growing:
            self.radius += 1
            if self.radius >= 35:
                self.growing = False
        else:
            self.radius -= 1
            if self.radius <= 10:
                # Remove target if it gets too small
                if self.parent:
                    self.parent.remove_widget(self)
                return

        self.size = (self.radius * 2, self.radius * 2)
        self.circle.size = self.size
        self.circle.pos = (self.center_x - self.radius, self.center_y - self.radius)

    def on_touch_down(self, touch):
        # Check if the click is inside the circle
        dx = touch.x - self.center_x
        dy = touch.y - self.center_y
        if (dx ** 2 + dy ** 2) ** 0.5 <= self.radius:
            if self.parent:
                self.parent.hit_target(self)
            return True
        return super().on_touch_down(touch)


class AimTrainer(Widget):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.score = 0
        self.score_label = Label(
            text="Score: 0", pos=(10, Window.height - 40), font_size="20sp"
        )
        self.add_widget(self.score_label)
        Clock.schedule_interval(self.spawn_target, 1.5)

    def spawn_target(self, dt):
        target = Target()
        self.add_widget(target)

    def hit_target(self, target):
        self.score += 1
        self.score_label.text = f"Score: {self.score}"
        self.remove_widget(target)


class AimTrainerApp(App):
    def build(self):
        return AimTrainer()


if __name__ == "__main__":
    AimTrainerApp().run()